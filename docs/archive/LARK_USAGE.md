# Lark 使用指南

## 📝 在 Lark 中生成原创推文

你的下级同事可以通过以下**两种方式**在 Lark 中唤醒原创推文生成：

---

## 方式 1：斜杠命令（推荐）⭐

### 基础用法
```
/tweet
```
生成一条默认主题（Codatta - data ownership, AI training, data labeling）的推文

### 自定义主题
```
/tweet 数据所有权
```
生成关于"数据所有权"主题的推文

```
/tweet Codatta 产品更新
```
生成关于"Codatta 产品更新"的推文

```
/tweet AI 公司压榨数据标注员
```
生成吐槽 AI 公司的推文

---

## 方式 2：自然语言（AI 理解）

直接在 Lark 中说话，系统会自动识别并生成推文：

### 示例 1
```
帮我生成一条关于数据所有权的推文
```

### 示例 2
```
写个关于 Codatta 的推文
```

### 示例 3
```
来条吐槽 AI 公司的推文
```

### 示例 4
```
发个推特谈谈数据标注员的权益
```

### 触发关键词
只要消息中包含以下任一关键词，系统就会尝试生成推文：
- `生成推文`
- `写推文`
- `发推`
- `tweet`
- `原创`
- `推特`

---

## 📋 生成后的流程

1. **AI 生成推文**
   - 系统会使用 Claude AI 生成符合 Jessie 人格的推文
   - 自动控制在 280 字符以内
   - 包含 Milady 风格、邪教感、对线风格

2. **发送审核卡片到 Lark**
   - 卡片会显示完整推文内容
   - 显示字符数统计
   - 显示主题和星期几

3. **审核操作**
   - ✅ **批准并发送** - 直接发送到 Twitter
   - 🔄 **重新生成** - 提示使用命令重新生成
   - ❌ **拒绝** - 拒绝该推文

---

## 🎯 推荐使用场景

### 定时发推
- 每天早上：`/tweet` - 生成今日推文
- 周一：`/tweet 数据所有权` - Codatta 核心主题
- 周五：`/tweet AI 行业观察` - 行业 insights
- 周日：`/tweet` - 轻松随性的内容

### 灵活响应
- 看到热点话题：`生成一条关于 XXX 的推文`
- Codatta 有更新：`/tweet Codatta 新功能发布`
- 想吐槽行业：`写个推文批评 AI 公司压榨数据标注员`

---

## 🔧 技术细节

### 支持的命令格式
```bash
/tweet                              # 默认主题
/tweet <主题>                       # 自定义主题
/tweet <多个词组成的主题>           # 支持空格
```

### AI 理解能力
系统会使用 Claude AI 理解你的意图，提取主题：
- 中文/英文都支持
- 可以识别具体的主题词
- 可以理解上下文

### 生成逻辑
- 根据当前星期几调整风格（参考 SKILL.md）
- 自动包含 🧹 或 🎀 签名 emoji
- 85% Codatta 相关，15% 社区真实感
- 使用 Milady 风格：邪教感、meme、对线

---

## 📊 数据库记录

每条生成的推文都会保存在 `original_content` 表中：
- `id` - 内容 ID
- `theme` - 主题
- `content` - 推文内容
- `day_of_week` - 星期几
- `approval_status` - 审核状态（pending/approved/rejected）
- `posted` - 是否已发送
- `posted_at` - 发送时间
- `posted_tweet_id` - Twitter 推文 ID

---

## 🚀 快速开始

1. 在 Lark 群聊中输入：
   ```
   /tweet
   ```

2. 等待 2-5 秒，系统会生成推文并发送审核卡片

3. 点击卡片上的"✅ 批准并发送"按钮

4. 推文自动发送到 Twitter！

---

## ⚠️ 注意事项

1. **Lark 权限配置**
   - 确保 Lark 机器人已添加到目标群聊
   - 确保机器人有"接收消息"权限
   - 需要在 Lark 开放平台配置事件订阅（`im.message.receive_v1`）

2. **生成速度**
   - 生成一条推文大约需要 3-5 秒
   - 不要连续快速发送多个请求

3. **主题建议**
   - 优先使用 Codatta 相关主题
   - 可以参考 `skills/SKILL.md` 中的内容主题

4. **审核流程**
   - 所有推文都需要人工审核后才会发送
   - 可以在审核卡片中查看完整内容
   - 批准后立即发送到 Twitter

---

## 📞 问题排查

### 1. 发送命令后没反应
- 检查 webhook_server.py 是否在运行
- 检查 Lark 事件订阅配置
- 查看 logs/webhook_server.log 日志

### 2. 生成的推文不符合预期
- 尝试提供更具体的主题
- 或使用 `/tweet <详细主题>` 格式
- 可以在审核时选择"拒绝"，然后重新生成

### 3. 推文超过 280 字符
- 系统会自动截断为 277 字符 + "..."
- 如果经常超长，可以在主题中说明"简短"

---

## 💡 高级用法

### 组合使用
早上定时任务 + Lark 灵活生成：
1. 使用 cron 定时执行 `python3 create_tweet.py` 生成早晨推文
2. 白天在 Lark 中根据需要灵活生成：`/tweet <主题>`
3. 所有推文都在 Lark 中统一审核

### 批量生成
想要多个选项时：
1. `/tweet 数据所有权` - 生成第一版
2. `/tweet data ownership` - 生成第二版（英文主题可能产生不同风格）
3. `/tweet Codatta` - 生成第三版
4. 在审核卡片中选择最满意的一条

---

## 🎉 开始使用

现在你可以在 Lark 中输入以下任意一条命令来测试：

```
/tweet
```

或

```
帮我生成一条推文
```

祝你使用愉快！🧹🎀
