# ğŸ§ª SAM æµ‹è¯•æŠ¥å‘Š

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

**æµ‹è¯•æ—¥æœŸï¼š** 2026-01-07
**æµ‹è¯•ç›®çš„ï¼š** éªŒè¯ SAM (Segment Anything Model) åœ¨ Milady NFT åƒç´ è‰ºæœ¯ä¸Šçš„é€‚ç”¨æ€§
**æµ‹è¯•çŠ¶æ€ï¼š** âš ï¸ éƒ¨åˆ†å®Œæˆï¼ˆé‡åˆ° API é™åˆ¶ï¼‰

---

## ğŸ”§ æµ‹è¯•ç¯å¢ƒ

- **Python ç‰ˆæœ¬ï¼š** 3.11
- **ä¾èµ–åŒ…ï¼š** replicate (1.0.7), Pillow (12.0.0)
- **API Tokenï¼š** âœ… å·²é…ç½®
- **æµ‹è¯•å›¾åƒï¼š** assets/milady_layers/Hat/Beret.png (2000x2500 â†’ 500x500)

---

## ğŸ“Š æµ‹è¯•ç»“æœ

### æµ‹è¯• 1: å›¾å±‚æ–‡ä»¶å‡†å¤‡

âœ… **æˆåŠŸ**

- æ‰¾åˆ°æµ‹è¯•å›¾åƒï¼š`assets/milady_layers/Hat/Beret.png`
- åŸå§‹å°ºå¯¸ï¼š2000x2500
- è°ƒæ•´ä¸ºï¼š500x500ï¼ˆä¸ NFT è¾“å‡ºå°ºå¯¸ä¸€è‡´ï¼‰
- RGBA â†’ RGB è½¬æ¢æˆåŠŸ
- è¾“å‡ºè·¯å¾„ï¼š`test_output/sam_layer_test/test_image.png`

---

### æµ‹è¯• 2: SAM API è°ƒç”¨

âŒ **å¤±è´¥ - API é™åˆ¶**

#### å°è¯•çš„æ¨¡å‹

**Model 1:** `cjwbw/segment-anything:92a56c1db8...`
- **ç»“æœï¼š** âŒ å¤±è´¥
- **é”™è¯¯ï¼š** `Invalid version or not permitted (422)`
- **åŸå› ï¼š** æ¨¡å‹ç‰ˆæœ¬ä¸å­˜åœ¨æˆ–æ— æƒé™è®¿é—®

**Model 2:** `meta/segment-anything-2-hiera-large:4a98e2c33e...`
- **ç»“æœï¼š** âŒ å¤±è´¥
- **é”™è¯¯ï¼š** `Request was throttled (429)`
- **åŸå› ï¼š** è´¦æˆ·ä½™é¢ < $5ï¼Œé€Ÿç‡é™åˆ¶ä¸ºæ¯åˆ†é’Ÿ 6 ä¸ªè¯·æ±‚

#### é”™è¯¯è¯¦æƒ…

```
ReplicateError Details:
status: 429
detail: Request was throttled. Your rate limit for creating predictions
is reduced to 6 requests per minute with a burst of 1 requests while
you have less than $5.0 in credit. Your rate limit resets in ~8s.
```

---

## ğŸš§ é‡åˆ°çš„é—®é¢˜

### é—®é¢˜ 1: Replicate è´¦æˆ·ä½™é¢ä¸è¶³

**ç°çŠ¶ï¼š**
- è´¦æˆ·ä½™é¢ < $5 USD
- è§¦å‘ä¸¥æ ¼çš„é€Ÿç‡é™åˆ¶ï¼š6 requests/min
- æ¯æ¬¡è°ƒç”¨éœ€ç­‰å¾…çº¦ 8-10 ç§’

**å½±å“ï¼š**
- æ— æ³•å¿«é€Ÿè¿ç»­æµ‹è¯•
- æµ‹è¯•æ•ˆç‡é™ä½
- å¯èƒ½å½±å“ç”Ÿäº§ç¯å¢ƒä½¿ç”¨

**è§£å†³æ–¹æ¡ˆï¼š**
1. **å……å€¼ $5+ åˆ° Replicate è´¦æˆ·**ï¼ˆæ¨èï¼‰
   - ç§»é™¤é€Ÿç‡é™åˆ¶
   - æå‡æµ‹è¯•æ•ˆç‡
   - ç¡®ä¿ç”Ÿäº§ç¯å¢ƒç¨³å®š

2. **ä½¿ç”¨æœ¬åœ° SAM æ¨¡å‹**
   - ä¸‹è½½ SAM æ¨¡å‹æ–‡ä»¶ï¼ˆ~375MB-2.4GBï¼‰
   - æœ¬åœ°æ¨ç†ï¼Œæ—  API é™åˆ¶
   - éœ€è¦ GPU åŠ é€Ÿï¼ˆå¯é€‰ï¼ŒCPU ä¹Ÿå¯è¿è¡Œä½†è¾ƒæ…¢ï¼‰

3. **ç­‰å¾…é€Ÿç‡é™åˆ¶é‡ç½®**
   - æ¯æ¬¡æµ‹è¯•é—´éš” 10+ ç§’
   - é€‚åˆå°è§„æ¨¡æµ‹è¯•
   - ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ

---

### é—®é¢˜ 2: SAM æ¨¡å‹ç‰ˆæœ¬ä¸ç¡®å®š

**ç°çŠ¶ï¼š**
- ç¬¬ä¸€ä¸ªæ¨¡å‹ç‰ˆæœ¬æ— æ•ˆ (422 error)
- ç¬¬äºŒä¸ªæ¨¡å‹å¯èƒ½æœ‰æ•ˆï¼Œä½†è¢«é€Ÿç‡é™åˆ¶é˜»æ­¢

**éœ€è¦éªŒè¯ï¼š**
- meta/segment-anything-2-hiera-large æ˜¯å¦æ˜¯æ­£ç¡®çš„æ¨¡å‹ï¼Ÿ
- æ˜¯å¦æœ‰å…¶ä»–å¯ç”¨çš„ SAM æ¨¡å‹ç‰ˆæœ¬ï¼Ÿ

**ä¸‹ä¸€æ­¥ï¼š**
1. å……å€¼åé‡è¯• meta/segment-anything-2-hiera-large
2. æˆ–åœ¨ Replicate ç½‘ç«™æœç´¢å¯ç”¨çš„ SAM æ¨¡å‹
3. æˆ–ä½¿ç”¨æœ¬åœ° SAM æ¨¡å‹

---

## ğŸ’° æˆæœ¬åˆ†æ

### å½“å‰ Replicate è´¦æˆ·çŠ¶æ€

- **ä½™é¢ï¼š** < $5 USD
- **é€Ÿç‡é™åˆ¶ï¼š** 6 requests/minï¼ˆä¸¥æ ¼é™åˆ¶ï¼‰
- **SAM è°ƒç”¨æˆæœ¬ï¼š** ~$0.001-0.003 USD / æ¬¡

### å»ºè®®å……å€¼é‡‘é¢

**é€‰é¡¹ A: æœ€å°å……å€¼ ($5)**
- ç§»é™¤é€Ÿç‡é™åˆ¶
- è¶³å¤Ÿæµ‹è¯• 50-100 ä¸ª NFT
- æ€»æˆæœ¬ï¼š$5 + $0.05-0.15 (æµ‹è¯•)

**é€‰é¡¹ B: æ¨èå……å€¼ ($10)**
- å……è¶³çš„æµ‹è¯•é¢„ç®—
- è¶³å¤ŸåˆæœŸç”Ÿäº§ä½¿ç”¨
- è¦†ç›– SAM + FLUX Fill Pro è°ƒç”¨

**é€‰é¡¹ C: æœ¬åœ° SAMï¼ˆå…è´¹ï¼Œä½†éœ€è¦è®¡ç®—èµ„æºï¼‰**
- ä¸€æ¬¡æ€§ä¸‹è½½æ¨¡å‹
- æ—  API è°ƒç”¨æˆæœ¬
- éœ€è¦ GPU æˆ–è¾ƒé•¿ CPU æ¨ç†æ—¶é—´

---

## ğŸ¯ SAM é›†æˆå¯è¡Œæ€§è¯„ä¼°

åŸºäºå½“å‰æµ‹è¯•ç»“æœï¼Œæˆ‘ä»¬**å°šæœªèƒ½éªŒè¯** SAM åœ¨ Milady NFT ä¸Šçš„æ•ˆæœï¼Œä½†å¯ä»¥æ ¹æ®å·²çŸ¥ä¿¡æ¯åšå‡ºåˆæ­¥åˆ¤æ–­ï¼š

### âœ… æŠ€æœ¯å¯è¡Œæ€§ï¼šé«˜

**ç†ç”±ï¼š**
1. SAM æ˜¯ Meta å¼€å‘çš„é€šç”¨åˆ†å‰²æ¨¡å‹
2. å·²åœ¨æ•°ç™¾ä¸‡å¼ å›¾åƒä¸Šè®­ç»ƒ
3. ç†è®ºä¸Šæ”¯æŒå„ç§å›¾åƒé£æ ¼
4. Replicate API é›†æˆç®€å•

### âš ï¸ å®é™…æ•ˆæœï¼šå¾…éªŒè¯

**éœ€è¦æµ‹è¯•çš„é—®é¢˜ï¼š**
1. â“ SAM èƒ½å¦æœ‰æ•ˆåˆ†å‰²åƒç´ è‰ºæœ¯é£æ ¼ï¼Ÿ
2. â“ åˆ†å‰²çš„é…é¥°åŒºåŸŸæ˜¯å¦å‡†ç¡®ï¼Ÿ
3. â“ æ˜¯å¦ä¼šå°†å¸½å­å’Œå¤´å‘è¯†åˆ«ä¸ºåŒä¸€åŒºåŸŸï¼Ÿ
4. â“ å°é…é¥°ï¼ˆè€³ç¯ã€é¡¹é“¾ï¼‰èƒ½å¦è¢«æ£€æµ‹åˆ°ï¼Ÿ

### ğŸ’° æˆæœ¬æ•ˆç›Šï¼šä¸­ç­‰

**SAM + FLUX Fill Pro æ€»æˆæœ¬ï¼š**
- SAM: ~$0.001-0.003 / å¼ 
- FLUX Fill Pro: ~$0.05 / å¼ 
- **æ€»è®¡ï¼š** ~$0.051-0.053 / å¼ ï¼ˆå¢åŠ  2-6%ï¼‰

**æ˜¯å¦å€¼å¾—ï¼Ÿ**
- âœ… å¦‚æœ SAM èƒ½æ”¯æŒæ‰€æœ‰å›¾å±‚ç±»å‹ï¼šéå¸¸å€¼å¾—
- âš ï¸ å¦‚æœ SAM åªé€‚ç”¨äºéƒ¨åˆ†é…é¥°ï¼šå¯èƒ½å€¼å¾—
- âŒ å¦‚æœ SAM æ•ˆæœä¸ä½³ï¼šä¸å€¼å¾—

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

### ç«‹å³è¡ŒåŠ¨ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

**é€‰é¡¹ A: å……å€¼ Replicate è´¦æˆ·ï¼ˆæ¨èï¼‰** â­

```bash
# 1. å‰å¾€ Replicate å……å€¼
https://replicate.com/account/billing

# 2. å……å€¼è‡³å°‘ $5-10 USD

# 3. é‡æ–°è¿è¡Œæµ‹è¯•
python3 test_sam_with_layer.py

# 4. å¦‚æœæˆåŠŸï¼Œæ‰©å±•æµ‹è¯•
python3 test_sam_simple.py 5050  # éœ€è¦ä¿®å¤ NFT åŠ è½½é—®é¢˜
```

**ä¼˜ç‚¹ï¼š**
- âœ… å¿«é€ŸéªŒè¯ SAM æ•ˆæœ
- âœ… ç§»é™¤é€Ÿç‡é™åˆ¶
- âœ… ç¡®ä¿ç”Ÿäº§ç¯å¢ƒç¨³å®š

**ç¼ºç‚¹ï¼š**
- âŒ éœ€è¦æ”¯ä»˜ $5-10ï¼ˆä½†å¯ä»¥ç”¨äºåç»­æµ‹è¯•å’Œç”Ÿäº§ï¼‰

---

**é€‰é¡¹ B: ä½¿ç”¨æœ¬åœ° SAM æ¨¡å‹**

```bash
# 1. å®‰è£… SAM
pip install git+https://github.com/facebookresearch/segment-anything.git

# 2. ä¸‹è½½æ¨¡å‹
# SAM ViT-B (375MB) - æœ€å¿«
# SAM ViT-L (1.2GB) - å¹³è¡¡
# SAM ViT-H (2.4GB) - æœ€å‡†

# 3. æ›´æ–°æµ‹è¯•è„šæœ¬ä½¿ç”¨æœ¬åœ° SAM

# 4. è¿è¡Œæµ‹è¯•
```

**ä¼˜ç‚¹ï¼š**
- âœ… å…è´¹ï¼ˆæ—  API è°ƒç”¨æˆæœ¬ï¼‰
- âœ… æ— é€Ÿç‡é™åˆ¶
- âœ… å¯ä»¥ç¦»çº¿ä½¿ç”¨

**ç¼ºç‚¹ï¼š**
- âŒ éœ€è¦ä¸‹è½½æ¨¡å‹ï¼ˆ375MB-2.4GBï¼‰
- âŒ éœ€è¦æ›´å¤šä»£ç ä¿®æ”¹
- âŒ CPU æ¨ç†è¾ƒæ…¢ï¼ˆGPU åŠ é€Ÿæ¨èï¼‰
- âŒ éœ€è¦ç®¡ç†æ¨¡å‹æ–‡ä»¶

---

**é€‰é¡¹ C: æš‚ç¼“ SAM é›†æˆ**

ä¿æŒå½“å‰çš„ 6 ä¸ªé¢„å®šä¹‰åŒºåŸŸï¼Œç­‰å¾…ï¼š
- æ›´å¤šç”¨æˆ·åé¦ˆ
- æ›´å¥½çš„åˆ†å‰²æ¨¡å‹
- è´¦æˆ·ä½™é¢å……è¶³æ—¶å†æµ‹è¯•

**ä¼˜ç‚¹ï¼š**
- âœ… å½“å‰ç³»ç»Ÿå·²å¯ç”¨
- âœ… æˆæœ¬å¯æ§

**ç¼ºç‚¹ï¼š**
- âŒ ä»ç„¶é™äº 6 ç§é…é¥°ç±»å‹
- âŒ æ— æ³•è‡ªåŠ¨é€‚é…ä¸åŒ NFT çš„é…é¥°ä½ç½®

---

## ğŸ’¡ æˆ‘çš„å»ºè®®

### æ¨èæ–¹æ¡ˆï¼šé€‰é¡¹ Aï¼ˆå……å€¼ Replicateï¼‰

**ç†ç”±ï¼š**

1. **å¿«é€ŸéªŒè¯** - å……å€¼åç«‹å³å¯æµ‹è¯•ï¼Œ1 å°æ—¶å†…å¾—å‡ºç»“è®º
2. **æˆæœ¬åˆç†** - $5-10 è¶³å¤Ÿå®Œæ•´æµ‹è¯•å’ŒåˆæœŸç”Ÿäº§
3. **æŠ€æœ¯ç®€å•** - æ— éœ€ä¸‹è½½æ¨¡å‹æˆ–ä¿®æ”¹å¤§é‡ä»£ç 
4. **ç”Ÿäº§å°±ç»ª** - Replicate API ç¨³å®šå¯é ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ

**å®æ–½æ­¥éª¤ï¼š**

1. å……å€¼ $5-10 åˆ° Replicate è´¦æˆ·
2. é‡æ–°è¿è¡Œ `test_sam_with_layer.py`
3. å¦‚æœæˆåŠŸï¼Œä¿®å¤ NFT åŠ è½½é—®é¢˜ï¼Œæµ‹è¯•å®Œæ•´ NFT
4. è¯„ä¼°åˆ†å‰²æ•ˆæœï¼ˆè¾¹ç•Œæ¡†å‡†ç¡®åº¦ã€IoU åˆ†æ•°ï¼‰
5. æ ¹æ®ç»“æœå†³å®šæ˜¯å¦ç»§ç»­ Phase 2ï¼ˆå®Œæ•´é›†æˆï¼‰

---

## ğŸ“ æµ‹è¯•æ¸…å•

### Phase 1.1: API éªŒè¯ âœ… å®Œæˆ

- [x] åˆ›å»ºæµ‹è¯•è„šæœ¬
- [x] å‡†å¤‡æµ‹è¯•å›¾åƒ
- [x] å°è¯•è°ƒç”¨ SAM API
- [x] è¯†åˆ«é—®é¢˜ï¼ˆé€Ÿç‡é™åˆ¶ï¼‰

### Phase 1.2: å……å€¼åéªŒè¯ â¸ï¸ å¾…å……å€¼

- [ ] å……å€¼ Replicate è´¦æˆ· ($5-10)
- [ ] éªŒè¯ SAM API å¯æ­£å¸¸è°ƒç”¨
- [ ] æŸ¥çœ‹ SAM è¾“å‡ºæ ¼å¼
- [ ] ç¡®è®¤æ˜¯å¦åŒ…å«è¾¹ç•Œæ¡†/æ©ç 

### Phase 1.3: æ•ˆæœè¯„ä¼° â¸ï¸ å¾…éªŒè¯

- [ ] æµ‹è¯•å¤šç§é…é¥°ç±»å‹ï¼ˆå¸½å­ã€çœ¼é•œã€è€³ç¯ç­‰ï¼‰
- [ ] è¯„ä¼°åˆ†å‰²å‡†ç¡®åº¦
- [ ] è®¡ç®—ä¸é¢„å®šä¹‰åŒºåŸŸçš„ IoU
- [ ] å†³å®šæ˜¯å¦ç»§ç»­é›†æˆ

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- **æµ‹è¯•è„šæœ¬ï¼š** `test_sam_with_layer.py` ï¼ˆå·²åˆ›å»ºï¼Œå¯è¿è¡Œï¼‰
- **æµ‹è¯•è¾“å‡ºï¼š** `test_output/sam_layer_test/test_image.png` ï¼ˆå·²ç”Ÿæˆï¼‰
- **é›†æˆæ–¹æ¡ˆï¼š** `SAM_INTEGRATION_PLAN.md`
- **æµ‹è¯•æŒ‡å—ï¼š** `SAM_TESTING_README.md`

---

## ğŸ“ æ€»ç»“

**å½“å‰çŠ¶æ€ï¼š** âš ï¸ æµ‹è¯•éƒ¨åˆ†å®Œæˆï¼Œé‡åˆ° API é€Ÿç‡é™åˆ¶

**æ ¸å¿ƒé—®é¢˜ï¼š** Replicate è´¦æˆ·ä½™é¢ < $5ï¼Œè§¦å‘ä¸¥æ ¼é€Ÿç‡é™åˆ¶

**æ¨èè¡ŒåŠ¨ï¼š** å……å€¼ $5-10 åˆ° Replicate è´¦æˆ·ï¼Œç»§ç»­æµ‹è¯•

**é¢„æœŸç»“æœï¼š** å……å€¼å 1 å°æ—¶å†…å¯å®Œæˆ SAM æ•ˆæœéªŒè¯

**ä¸‹ä¸€æ­¥ï¼š** ç­‰å¾…å……å€¼åç»§ç»­æµ‹è¯•ï¼Œæˆ–é€‰æ‹©æœ¬åœ° SAM æ–¹æ¡ˆ

---

**æŠ¥å‘Šæ—¥æœŸï¼š** 2026-01-07
**æµ‹è¯•äººå‘˜ï¼š** Claude (AI Assistant)
**çŠ¶æ€ï¼š** å¾…ç”¨æˆ·å†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
